# This file has been generated by ansible - DO NOT MODIFY MANUALLY
#
# Configuration file for Synapse.
#
# This is a YAML file: see [1] for a quick introduction. Note in particular
# that *indentation is important*: all the elements of a list or dictionary
# should have the same indentation.
#
# [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
#
# For more information on how to configure Synapse, including a complete accounting of
# each option, go to docs/usage/configuration/config_documentation.md or
# https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html

server_name: {{ matrix_hostname }}
  
#enable_registration_without_verification: true  

pid_file: /data/homeserver.pid

public_baseurl: {{ matrix_base_url }}

max_upload_size: 50M
 
enable_media_repo: true

email:
  smtp_host: {{ smtp_host }}
  smtp_port: 587
  smtp_user: {{ smtp_user }}
  smtp_pass: {{ smtp_pass }}
  force_tls: true
  require_transport_security: false
  enable_tls: true
  notif_from: "Your Friendly %(app)s homeserver <matrix-test@epfl.ch>"
  app_name: my_branded_matrix_server
  enable_notifs: true
  notif_for_new_users: true
  client_base_url: {{ element_base_url }}
  validation_token_lifetime: 15m
  invite_client_location: {{ element_base_url}}

  subjects:
    message_from_person_in_room: "[%(app)s] You have a message on %(app)s from %(person)s in the %(room)s room..."
    message_from_person: "[%(app)s] You have a message on %(app)s from %(person)s..."
    messages_from_person: "[%(app)s] You have messages on %(app)s from %(person)s..."
    messages_in_room: "[%(app)s] You have messages on %(app)s in the %(room)s room..."
    messages_in_room_and_others: "[%(app)s] You have messages on %(app)s in the %(room)s room and others..."
    messages_from_person_and_others: "[%(app)s] You have messages on %(app)s from %(person)s and others..."
    invite_from_person_to_room: "[%(app)s] %(person)s has invited you to join the %(room)s room on %(app)s..."
    invite_from_person: "[%(app)s] %(person)s has invited you to chat on %(app)s..."
    password_reset: "[%(server_name)s] Password reset"
    email_validation: "[%(server_name)s] Validate your email"

listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [client, federation]
        compress: false
database:
  name: psycopg2
  args:
    user: {{ db_user }}
    password: {{ db_password }}
    database: {{ db_name }}
    host: {{ db_host }}
    cp_min: 5
    cp_max: 10

log_config: "/data/matrix-fsd.epfl.ch.log.config"

saml2_config:
  idp_name: {{ sml_idp_name }}
  sp_config:
    metadata:
      remote:
        - url: {{ sml_remote_url }}
          #    key_file: /data/ssl/privkey.pem
          #    cert_file: /data/ssl/fullchain.pem

          #  encryption_keypairs:
          #    - key_file: /data/ssl/privkey.pem
          #      cert_file: /data/ssl/fullchain.pem
    user_mapping_provider:
    config:
      mxid_source_attribute: uid
      mxid_mapping: dotreplace

registrations_require_3pid:
  - email

 #auto_join_rooms:
#  - "#space_isas-fsd:matrix-fsd.epfl.ch"
#  - "#isas-fsd:matrix-fsd.epfl.ch"
#  - "#isas:matrix-fsd.epfl.ch"
#  - "#space_isas:matrix-fsd.epfl.ch"         


enable_registration: false

        #password_config:
        #  enabled: false    

#  handlers:
#  file:
    # [...]
#    level: DEBUG

loggers:
  oidc_providers:
    level: DEBUG
  # [...]
#  ldap3:
#    level: DEBUG
#   ldap_auth_provider:
#    level: DEBUG


#chown 991:991
media_store_path: /data/media_store

registration_shared_secret: {{ registration_shared_secret }}

report_stats: true

macaroon_secret_key: {{ macaroon_secret_key }}

form_secret: {{ form_secret }}

signing_key_path: "/data/matrix-fsd.epfl.ch.signing.key"

trusted_key_servers: []

app_service_config_files:
 - /data/mautrix-telegram/registration.yaml


#modules:
#  - module: "ldap_auth_provider.LdapAuthProviderModule"
#   config:
#     enabled: true
#     uri: "ldaps://ldap.epfl.ch:636"
#     start_tls: false
#     base: "ou=services,o=epfl,c=ch"  
#     attributes:
#       uid: "cn"
#       mail: "email"
#       name: "givenName"
       #filter: ""

# vim:ft=yaml